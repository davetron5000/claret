#!/usr/bin/env ruby

require 'rubygems'
require 'gli'
require 'claret/version'
require 'yaml'

include GLI::App

program_desc 'Describe your application here'

version Claret::VERSION

FILE = File.join(ENV['HOME'],'.claret.yml')

commands_from 'claret/commands'

pre do |global,command,options,args|
  $tasks = []
  if File.exists?(FILE)
    $tasks = YAML::load(File.open(FILE))
    $tasks.each do |task|
      task.force_encoding("UTF-8")
    end
  end
  true
end

post do
  File.open(FILE,'w') do |file|
    file.puts $tasks.to_yaml
  end
end

exit run(ARGV)
