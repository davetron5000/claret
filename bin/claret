#!/usr/bin/env ruby

require 'rubygems'
require 'gli'
require 'claret'
require 'yaml'

include GLI::App

program_desc 'Describe your application here'

version Claret::VERSION

FILE = File.join(ENV['HOME'],'.claret.yml')

commands_from 'claret/commands'

task_list_serializer = Claret::TaskListYamlSerializer.new

pre do |global,command,options,args|
  begin
    $task_list = task_list_serializer.read(File.open(FILE))
  rescue Errno::ENOENT
    $task_list = Claret::TaskList.new
  end
  true
end

post do
  task_list_serializer.write($task_list,File.open(FILE,'w'))
end

exit run(ARGV)
